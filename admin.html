<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çˆ±å¿ƒå¼¹çª—ç”Ÿæˆå™¨ - ç®¡ç†å‘˜ç³»ç»Ÿ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft YaHei', sans-serif; background: linear-gradient(135deg, #667eea, #764ba2); min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); width: 100%; max-width: 600px; margin-bottom: 20px; }
        h1 { color: #333; margin-bottom: 20px; text-align: center; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #555; font-weight: bold; }
        input, textarea, select { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; transition: all 0.3s; }
        input:focus, textarea:focus, select:focus { border-color: #667eea; outline: none; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2); }
        textarea { height: 100px; resize: vertical; }
        .btn { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 15px 30px; font-size: 18px; border-radius: 8px; cursor: pointer; margin: 10px 0; transition: all 0.3s; font-weight: bold; width: 100%; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .btn-success { background: linear-gradient(135deg, #28a745, #20c997); }
        .link-container { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px dashed #ccc; }
        .link { word-break: break-all; font-size: 14px; color: #667eea; margin-bottom: 10px; padding: 10px; background: white; border-radius: 5px; border: 1px solid #ddd; }
        .copy-btn { background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 14px; margin-top: 10px; }
        .orders-list { margin-top: 30px; }
        .order-item { padding: 15px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; background: #f8f9fa; }
        .order-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .order-id { font-weight: bold; color: #333; }
        .order-status { padding: 3px 8px; border-radius: 4px; font-size: 12px; }
        .status-used { background: #dc3545; color: white; }
        .status-unused { background: #28a745; color: white; }
        .order-details { font-size: 14px; color: #666; }
        .admin-info { background: rgba(102, 126, 234, 0.1); padding: 10px; border-radius: 8px; margin-bottom: 20px; text-align: center; font-weight: bold; color: #667eea; }
        .preview-btn { background: #ffc107; color: #212529; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 14px; margin-left: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’Œ çˆ±å¿ƒå¼¹çª—ç”Ÿæˆå™¨ - ç®¡ç†å‘˜ç³»ç»Ÿ</h1>
        <div class="admin-info">
            <p>æ¬¢è¿ï¼Œç®¡ç†å‘˜ï¼ç”Ÿæˆé“¾æ¥åç›´æ¥å‘é€ç»™ç”¨æˆ·å³å¯ä½¿ç”¨</p>
        </div>
        <div class="form-group">
            <label for="sender">å‘é€è€…ï¼š</label>
            <input type="text" id="sender" placeholder="è¾“å…¥å‘é€è€…åå­—" value="äº²çˆ±çš„">
        </div>
        <div class="form-group">
            <label for="receiver">æ¥æ”¶è€…ï¼š</label>
            <input type="text" id="receiver" placeholder="è¾“å…¥æ¥æ”¶è€…åå­—">
        </div>
        <div class="form-group">
            <label for="message-style">å¼¹çª—æ ·å¼ï¼š</label>
            <select id="message-style">
                <option value="romantic">æµªæ¼«è¡¨ç™½</option>
                <option value="miss">æ€å¿µæƒ³å¿µ</option>
                <option value="apology">é“æ­‰è®¤é”™</option>
                <option value="custom">è‡ªå®šä¹‰æ¶ˆæ¯</option>
            </select>
        </div>
        <div class="form-group" id="custom-messages-group" style="display: none;">
            <label for="custom-messages">è‡ªå®šä¹‰æ¶ˆæ¯ï¼ˆæ¯è¡Œä¸€æ¡ï¼‰ï¼š</label>
            <textarea id="custom-messages" placeholder="è¾“å…¥å¼¹çª—æ¶ˆæ¯ï¼Œæ¯è¡Œä¸€æ¡">æˆ‘æƒ³ä½ äº†ï¼
æˆ‘å¥½å–œæ¬¢ä½ ï¼
ä½ æ˜¯æˆ‘æœ€é‡è¦çš„äººï¼
æ¯å¤©éƒ½æƒ³è§åˆ°ä½ ï¼
ğŸ’• çˆ±ä½  ğŸ’•</textarea>
        </div>
        <button class="btn" id="generate-btn">âœ¨ ç”Ÿæˆå¼¹çª—é“¾æ¥ âœ¨</button>
        <div class="link-container" id="link-container" style="display: none;">
            <p><strong>ç”Ÿæˆçš„é“¾æ¥ï¼š</strong></p>
            <p class="link" id="generated-link"></p>
            <button class="copy-btn" id="copy-btn">ğŸ“‹ å¤åˆ¶é“¾æ¥</button>
            <button class="preview-btn" id="preview-btn">ğŸ‘€ é¢„è§ˆæ•ˆæœ</button>
        </div>
    </div>

    <div class="container">
        <h2>å·²ç”Ÿæˆçš„è®¢å•</h2>
        <div class="orders-list" id="orders-list">
            <!-- è®¢å•åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <!-- å¼¹çª—é¢„è§ˆå®¹å™¨ -->
    <div id="preview-container" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 1000;">
        <button id="close-preview" style="position: absolute; top: 20px; right: 20px; background: #dc3545; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;">å…³é—­é¢„è§ˆ</button>
    </div>

    <script>
        // æ¶ˆæ¯æ¨¡æ¿
        const messageTemplates = {
            romantic: ["æˆ‘çˆ±ä½ ï¼ğŸ’•", "ä½ æ˜¯æˆ‘ç”Ÿå‘½ä¸­æœ€é‡è¦çš„äººï¼", "æˆ‘çš„å¿ƒåªå±äºä½ ï¼", "å’Œä½ åœ¨ä¸€èµ·çš„æ¯ä¸€å¤©éƒ½å¾ˆå¹¸ç¦ï¼", "æˆ‘æƒ³å’Œä½ ä¸€èµ·æ…¢æ…¢å˜è€ï¼â¤ï¸"],
            miss: ["æˆ‘æƒ³ä½ äº†ï¼", "å¥½æƒ³ç«‹åˆ»è§åˆ°ä½ ï¼", "æ²¡æœ‰ä½ åœ¨èº«è¾¹ï¼Œæ—¶é—´è¿‡å¾—å¥½æ…¢", "æ¯å¤©éƒ½åœ¨æ€å¿µä½ ", "å¥½æƒ³æŠ±æŠ±ä½ å‘€ï¼ğŸ¤—"],
            apology: ["å¯¹ä¸èµ·ï¼Œæˆ‘é”™äº†ï¼", "è¯·åŸè°…æˆ‘å¥½å—ï¼Ÿ", "æˆ‘çŸ¥é“æˆ‘è®©ä½ ä¼¤å¿ƒäº†", "æˆ‘ä¼šæ”¹çš„ï¼Œç›¸ä¿¡æˆ‘", "å†ç»™æˆ‘ä¸€æ¬¡æœºä¼šå§ï¼ğŸ™"]
        };

        // æ˜¾ç¤º/éšè—è‡ªå®šä¹‰æ¶ˆæ¯è¾“å…¥æ¡†
        document.getElementById('message-style').addEventListener('change', function() {
            const customGroup = document.getElementById('custom-messages-group');
            customGroup.style.display = this.value === 'custom' ? 'block' : 'none';
        });

        // ç”Ÿæˆé“¾æ¥
        document.getElementById('generate-btn').addEventListener('click', function() {
            const sender = document.getElementById('sender').value.trim();
            const receiver = document.getElementById('receiver').value.trim();
            const messageStyle = document.getElementById('message-style').value;
            
            if (!sender || !receiver) {
                alert('è¯·å¡«å†™å‘é€è€…å’Œæ¥æ”¶è€…åå­—ï¼');
                return;
            }
            
            // è·å–æ¶ˆæ¯å†…å®¹
            let messages;
            if (messageStyle === 'custom') {
                messages = document.getElementById('custom-messages').value.split('\n').filter(msg => msg.trim());
                if (messages.length === 0) {
                    alert('è¯·å¡«å†™è‡ªå®šä¹‰æ¶ˆæ¯ï¼');
                    return;
                }
            } else {
                messages = messageTemplates[messageStyle];
            }
            
            // ç”Ÿæˆå”¯ä¸€ID
            const orderId = generateOrderId();
            
            // ä¿å­˜è®¢å•æ•°æ®
            const orderData = {
                id: orderId,
                sender: sender,
                receiver: receiver,
                messages: messages,
                used: false,
                createdAt: new Date().toLocaleString()
            };
            
            saveOrder(orderData);
            
            // ç”Ÿæˆé“¾æ¥
            const link = generatePopupLink(orderData);
            
            // æ˜¾ç¤ºé“¾æ¥
            document.getElementById('generated-link').textContent = link;
            document.getElementById('link-container').style.display = 'block';
            
            // æ›´æ–°è®¢å•åˆ—è¡¨
            updateOrdersList();
        });

        // å¤åˆ¶é“¾æ¥
        document.getElementById('copy-btn').addEventListener('click', function() {
            const link = document.getElementById('generated-link').textContent;
            copyToClipboard(link);
            alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
        });

        // é¢„è§ˆæ•ˆæœ
        document.getElementById('preview-btn').addEventListener('click', function() {
            const sender = document.getElementById('sender').value.trim();
            const receiver = document.getElementById('receiver').value.trim();
            const messageStyle = document.getElementById('message-style').value;
            
            let messages;
            if (messageStyle === 'custom') {
                messages = document.getElementById('custom-messages').value.split('\n').filter(msg => msg.trim());
            } else {
                messages = messageTemplates[messageStyle];
            }
            
            showPreview(sender, receiver, messages);
        });

        // å…³é—­é¢„è§ˆ
        document.getElementById('close-preview').addEventListener('click', function() {
            document.getElementById('preview-container').style.display = 'none';
        });

        // ç”Ÿæˆè®¢å•ID
        function generateOrderId() {
            return 'order_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // ä¿å­˜è®¢å•
        function saveOrder(orderData) {
            let orders = JSON.parse(localStorage.getItem('lovePopupOrders') || '[]');
            orders.push(orderData);
            localStorage.setItem('lovePopupOrders', JSON.stringify(orders));
        }

        // ç”Ÿæˆå¼¹çª—é“¾æ¥
        function generatePopupLink(orderData) {
            // åˆ›å»ºä¸€ä¸ªåŒ…å«è®¢å•æ•°æ®çš„URL
            const data = btoa(JSON.stringify(orderData));
            // ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œç¡®ä¿åœ¨GitHub Pagesä¸Šæ­£å¸¸å·¥ä½œ
            return window.location.href.replace('admin.html', 'popup.html') + '?data=' + encodeURIComponent(data);
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text);
            } else {
                // å¤‡ç”¨æ–¹æ³•
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            }
        }

        // æ›´æ–°è®¢å•åˆ—è¡¨
        function updateOrdersList() {
            const ordersList = document.getElementById('orders-list');
            let orders = JSON.parse(localStorage.getItem('lovePopupOrders') || '[]');
            
            // æŒ‰åˆ›å»ºæ—¶é—´å€’åºæ’åˆ—
            orders.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (orders.length === 0) {
                ordersList.innerHTML = '<p>æš‚æ— è®¢å•</p>';
                return;
            }
            
            let html = '';
            orders.forEach(order => {
                const status = order.used ? 
                    '<span class="order-status status-used">å·²ä½¿ç”¨</span>' : 
                    '<span class="order-status status-unused">æœªä½¿ç”¨</span>';
                
                html += `
                    <div class="order-item">
                        <div class="order-header">
                            <span class="order-id">è®¢å•: ${order.id.substr(0, 10)}...</span>
                            ${status}
                        </div>
                        <div class="order-details">
                            <p><strong>å‘é€è€…:</strong> ${order.sender} â†’ <strong>æ¥æ”¶è€…:</strong> ${order.receiver}</p>
                            <p><strong>æ¶ˆæ¯:</strong> ${order.messages.slice(0, 3).join(', ')}${order.messages.length > 3 ? '...' : ''}</p>
                            <p><strong>åˆ›å»ºæ—¶é—´:</strong> ${order.createdAt}</p>
                        </div>
                    </div>
                `;
            });
            
            ordersList.innerHTML = html;
        }

        // æ˜¾ç¤ºé¢„è§ˆ
        function showPreview(sender, receiver, messages) {
            const previewContainer = document.getElementById('preview-container');
            previewContainer.style.display = 'block';
            
            // æ¸…ç©ºé¢„è§ˆå®¹å™¨
            previewContainer.innerHTML = '<button id="close-preview" style="position: absolute; top: 20px; right: 20px; background: #dc3545; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;">å…³é—­é¢„è§ˆ</button>';
            
            // é‡æ–°ç»‘å®šå…³é—­äº‹ä»¶
            document.getElementById('close-preview').addEventListener('click', function() {
                previewContainer.style.display = 'none';
            });
            
            // åˆ›å»ºé¢„è§ˆå¼¹çª—
            createPreviewPopups(sender, receiver, messages);
        }

        // åˆ›å»ºé¢„è§ˆå¼¹çª—
        function createPreviewPopups(sender, receiver, messages) {
            const previewContainer = document.getElementById('preview-container');
            let popupCount = 0;
            const maxPopups = 15;
            
            const interval = setInterval(() => {
                if (popupCount >= maxPopups) {
                    clearInterval(interval);
                    return;
                }
                
                createPreviewPopup(sender, receiver, messages, previewContainer);
                popupCount++;
                
            }, 500);
        }

        // åˆ›å»ºå•ä¸ªé¢„è§ˆå¼¹çª—
        function createPreviewPopup(sender, receiver, messages, container) {
            const popup = document.createElement('div');
            popup.style.position = 'absolute';
            popup.style.background = 'linear-gradient(135deg, #ff9a9e, #fad0c4)';
            popup.style.border = '3px solid #ff69b4';
            popup.style.borderRadius = '15px';
            popup.style.padding = '15px 20px';
            popup.style.boxShadow = '0 5px 25px rgba(0, 0, 0, 0.3)';
            popup.style.zIndex = '1000';
            popup.style.animation = 'float 3s ease-in-out infinite, appear 0.5s ease-out';
            popup.style.minWidth = '180px';
            popup.style.textAlign = 'center';
            popup.style.cursor = 'pointer';
            popup.style.userSelect = 'none';
            
            // éšæœºä½ç½®
            const left = Math.random() * (window.innerWidth - 200);
            const top = Math.random() * (window.innerHeight - 100);
            
            popup.style.left = left + 'px';
            popup.style.top = top + 'px';
            
            // éšæœºæ¶ˆæ¯
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            
            popup.innerHTML = `
                <div style="font-size: 18px; font-weight: bold; color: #d5006d; font-family: æ¥·ä½“, STKaiti, serif;">
                    ${randomMessage}
                </div>
            `;
            
            container.appendChild(popup);
            
            // ç‚¹å‡»å…³é—­
            popup.addEventListener('click', function() {
                this.style.animation = 'fadeOut 0.5s forwards';
                setTimeout(() => this.remove(), 500);
            });
            
            // 10ç§’åè‡ªåŠ¨æ¶ˆå¤±
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.style.animation = 'fadeOut 0.5s forwards';
                    setTimeout(() => popup.remove(), 500);
                }
            }, 10000);
        }

        // æ·»åŠ åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes float {
                0%, 100% { transform: translateY(0) rotate(0deg); }
                50% { transform: translateY(-15px) rotate(2deg); }
            }
            
            @keyframes appear {
                from { opacity: 0; transform: scale(0.8); }
                to { opacity: 1; transform: scale(1); }
            }
            
            @keyframes fadeOut {
                from { opacity: 1; transform: scale(1); }
                to { opacity: 0; transform: scale(0.5); }
            }
        `;
        document.head.appendChild(style);

        // åˆå§‹åŒ–æ—¶æ›´æ–°è®¢å•åˆ—è¡¨
        updateOrdersList();
    </script>
</body>
</html>